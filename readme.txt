************************************************************
*               ****************************               *
*               *    Ｂ ｒ ｉ ｄ ｇ ｅ     *               *
*               *  @@@@[][]     [][]@@@@   *               *
*               *  @@  []  [] []  @@       *               *
*               *  @@@@[][]   []  @@       *               *
*               *  @@  []  [] []  @@       *               *
*               *  @@@@[][][]   [][]@@@@.  *               *
*               ****************************               *
*                     written by. Mr_WaterT                *
*                                                          *
*           https://github.com/krynen/BridgeBBCC           *
*                                                          *
************************* 사 용 법 *************************
*                                                          *
* 1. 아래를 참고해 lib/config.js의 내용을 조정             *
*                                                          *
* 2. 송출 소프트에어의 Webpage Source에 client.html을 추가 *
*                                                          *
* 3. 로고 표시로 로딩완료를 확인한 후 방송하기             *
*                                                          *
*                                                          *
**********************  패 치  노 트  **********************
*                                                          *
*      **********************************************      *
*      * 0.5.3 :  7th May 2020                      *      *
*      **********************************************      *
* 추가 및 개선된 기능                                      *
* - 채팅방 명령어 추가                                     *
*   scale (배율 숫자) : 화면 배율 조정                     *
*   숫자 미입력시 현재 배율 표시                           *
*                                                          *
* - URL로부터 설정을 불러오는 기능 추가                    *
*   "(경로)?(key_1)=(value_1)&...&(key_n)=(value_n)"       *
*   channel은 #을 제외하고, muteUser는 ','를 구분자로      *
*   scale로 화면 배율 지정 가능                            *
*                                                          *
* - 메세지가 사라질 때 애니메이션의 시간에 대한 설정 추가  *
*   msgAniDuration 설정                                    *
*                                                          *
*                                                          *
* 오류 수정 및 변경된 기능                                 *
* - 특정 텍스트 변환 옵션이 적용되지 않던 문제 수정        *
* - &를 포함한 일부 텍스트를 있는 그대로 표시              *
*   replaceMsgs 설정이 정상적으로 동작하지만               *
*   &, <, >가 이스케이핑된 후 텍스트 대체가 이루어짐       *
*                                                          *
* - 채널 접속을 다시 시도하지 않던 문제 수정               *
*   채팅 서버와의 연결이 종료되었을 때                     *
*                                                          *
* - 일부 기본 설정 불러오기를 제대로 하지 않던 문제 수정   *
*                                                          *
*                                                          *
* 적용 예정이 없는 부분                                    *
* - 일부 후원 아이콘 표시                                  *
*   기간한정 및 스트리머 전용 후원 아이콘이 적용되지 않음  *
*   twitchemotes api 지원이 끊겨 구현이 어려움             *
*                                                          *
* - 채널 포인트로 메세지 강조                              *
*                                                          *
*                                                          *
* 개발자를 위한 메세지                                     *
* - 메세지가 사라질 때 .chat_outer_box에 .remove가 추가됨  *
*   사라질 때의 애니메이션을 별도로 지정하지 않을 경우     *
*   메세지가 나타날 때의 애니메이션이 반전되어 사용됨      *
*                                                          *
* - 메세지 애니메이션을 여러 개 동시에 적용시킬 경우       *
*   정상적인 동작을 보장할 수 없음                         *
*                                                          *
*                                                          *
********************** config.js 설정 **********************
*                                                          *
* 접근성 표시 (*)를 참고                                   *
* lib\config.js의 내용을 설정할 것                         *
*                                                          *
*                                                          *
* numChatMax       (*) 한번에 표시할 최대 메세지 수        *
*                                                          *
* personalColor    (*) 이름 색을 트위치 웹 채팅과 같게     *
*                  일부 유저에게 효과 없을 수 있음         *
*                  -> true, false                          *
*                                                          *
* badgeVisible     (**) 뱃지 아이콘 표시 여부              *
*                  -> true, false                          *
*                                                          *
* themeUri         (***) 테마를 불러올 주소                *
*                  "https://..."                           *
*                  빈 문자열일 경우 상대 경로에서 불러옴   *
*                                                          *
* theme            (***) 사용할 기본 테마                  *
*                  theme 폴더 안의 하위 폴더 이름 문자열   *
*                  -> "테마 이름"                          *
*                                                          *
* msgExistDuration (*) 각 메세지의 제한 시간 (초)          *
*                  -> 0 입력시 제한 시간을 두지 않음       *
*                                                          *
* msgAniDuration   (**) 메세지가 사라질 때 표시되는        *
*                  애니메이션의 동작 시간 (초)             *
*                  -> 0 입력시 애니메이션을 표시하지 않음  *
*                  -> -1 입력시 테마의 기본 값을 사용      *
*                                                          *
* debugLevel       초기 로딩 메세지를 포함한               *
*                  디버그메세지의 표시 여부                *
*                  -> 0 (미표시)                           *
*                  -> 1 (개발자도구에 로그만 남김)         *
*                  -> 2 (메세지로 출력)                    *
*                                                          *
* loadCheerImgs    (*) cheermote를 이미지로 치환해 표시    *
*                  -> true, false                          *
*                                                          *
* loadTwitchCons   (*) 트위치 이모티콘과 구독콘을          *
*                  이미지로 표시할지 여부                  *
*                  -> true, false                          *
*                                                          *
* loadDcCons       (**) 디시콘 사용 여부                   *
*                  -> true, false                          *
*                                                          *
* dcConsURI        (**) 디시콘을 불러올 주소               *
*                  ""일 경우 pc의 하위디렉토리에서 불러옴  *
*                  lib/dccon_list.js와                     *
*                  images/dccon 폴더를 사용                *
*                                                          *
* subMonthsMsg     (*) 구독 기념 메세지의 강조 문구        *
*                  {months}는 개월수로 대체됨              *
*                  {0:내용}은 구독 시작시에만 표기         *
*                  {!0:내용}은 구독 유지시에만 표기됨      *
*                                                          *
* cheersMsg        (*) 비트 도네이션 메세지의 강조 문구    *
*                  {bits}는 후원 금액 수치로 대체됨        *
*                  {0:내용}은 총금액을 알 수 없을 때 표기  *
*                  {!0:내용}은 그렇지 않을경우에만 표기됨  *
*                                                          *
* clipReplaceMsg   (**) 클립 링크의 대체 텍스트            *
*                  빈 문자열일 경우 대체하지 않음          *
*                  -> "대체할텍스트"                       *
*                                                          *
* linkReplaceMsg   (**) 일반 링크의 대체 텍스트            *
*                  설정에 따라 클립 링크도 대체할 수 있음  *
*                  빈 문자열일 경우 대체하지 않음          *
*                  -> "대체할텍스트"                       *
*                                                          *
* channel          (***) 접속할 채널                       *
*                  "#로그인아이디"                         *
*                                                          *
* retryInterval    접속이 끊겼을 때 재접속 시도 시간 간격  *
*                  초                                      *
*                                                          *
* allMessageHandle 처리되지 않은 메세지를 표시             *
*                  디버그를 위한 기능이므로 false를 권장   *
*                  -> true, false                          *
*                                                          *
* muteUser         (**) 특정 유저의 메세지를 표시하지 않기 *
*                  ["로그인아이디", "닉네임", "..."]       *
*                                                          *
* deleteBanMsg     (*) 밴된 유저의 메세지를                *
*                  <message deleted>로 바꾸기              *
*                  -> true, false                          *
*                                                          *
* commands         (*) 채팅방 명령어를 사용                *
*                  [{exe:"명령1", msg:"입력 명령어1"},     *
*                   {exe:"명령2", msg:"입력 명령어2"}]     *
*                  정규표현식을 알아야 사용할만 함         *
*                  기본 설정 이용 권장                     *
*                                                          *
* replaceMsgs      (*) 특정 텍스트를 변환하기              *
*                  [{orig:"이전1", to:"이후1"},            *
*                   {orig:"이전2", to:"이후2"}]            *
*                  정규표현식을 알아야 사용할만 함         *
*                                                          *
*                  nick:"영어아이디"를 포함하면            *
*                  특정유저의 메세지만 변환할 수 있음      *
*                                                          *
************************************************************


********************* Version History **********************
* **********************************************           *
* * 0.5.2 :  21th Apr 2020                     *           *
* **********************************************           *
* HOTFIX 0.5.1 -> 0.5.2                                    *
* - 모든 메세지가 링크로 인식되어 변환되는 문제를 수정     *
*                                                          *
* 추가 및 개선된 기능                                      *
* - 클립 링크 대체 방식 변경 및 일반 링크 대체 기능 추가   *
*   linkReplaceMsg 설정 추가                               *
*   클립 링크를 조금 더 정밀하게 검색                      *
*                                                          *
* 오류 수정 및 변경된 기능                                 *
* - 구독콘과 트위치 이모티콘이 한 개만 표시되던 문제 수정  *
*   한 채팅에 두번 입력했을 때에도 제대로 변환됨           *
*                                                          *
* **********************************************           *
* * 0.5.0 :  14th Apr 2020                     *           *
* **********************************************           *
* 추가 및 개선된 기능                                      *
* - 채팅방 명령어 추가                                     *
*   load : 새로고침 없이 디시콘 다시 로드                  *
* - 디시콘 리스트 갱신 최적화                              *
*   로드에 캐시를 사용하지 않아 파일 변경에 빠르게 대응    *
* - 기간 한정 뱃지를 포함한 모든 뱃지를 표시               *
*   스트리머 전용 뱃지는 badgeChannelId 설정이 필요        *
* - 표시되는 후원 아이콘 추가                              *
*   anon, pogchamp 등 누락된 퍼스트파티 아이콘 14개        *
*                                                          *
* 오류 수정 및 변경된 기능                                 *
* - 후원 아이콘이 제대로 표시되지 않던 문제 수정           *
*   표시 방식을 바꿔 10~99비트 구간에서도 아이콘이 표시    *
* - msgExistDuration 설정시 발생하던 문제 수정             *
*   더 이상 numChatMax가 늘어나는 것처럼 작동하지 않음     *
* - 일부 메세지가 제대로 표시되지 않던 문제 수정           *
*   특수문자 이모티콘(<3)이 포함된 메세지                  *
*   나 명령어(/me, 통칭 색챗)를 사용해 보낸 메세지         *
* - 구독 개월 수가 항상 0개월 째로 표시되던 문제 수정      *
*                                                          *
* 제거된 기능                                              *
* - 클립 미리보기                                          *
*   loadClipPreview 설정                                   *
*   clipReplaceMsg는 입력시 모든 클립 링크를 대체함        *
* - 미구독자의 구독콘 표시                                 *
*   consRealSubsOnly 설정                                  *
* - 뱃지 이미지 직접 할당                                  *
*   더 이상 images/badge 폴더를 사용하지 않음              *
*                                                          *
* 기타 수정사항                                            *
* - 디버그 메세지 표기 방식을 수정                         *
* - 로고 표기 방식을 수정                                  *
* - 기본 설정값 일부 변경                                  *
*   clipReplaceMsg, commands                               *
*                                                          *
*                                                          *
* **********************************************           *
* * 0.3.0 : 14th Sep 2017                      *           *
* **********************************************           *
* 추가된 기능                                              *
* - 채팅방 명령어 활성화                                   *
*   clear : 채팅방 청소                                    *
*           (/clear 입력시 트위치 채팅방과 동시에 청소됨)  *
*   theme 테마폴더이름 : 테마 변경                         *
*   configData.commands에서 대응 명령어를 바꿀 수 있음     *
*                                                          *
* 오류 수정 및 변경된 기능                                 *
* - admin, globalmod, staff 뱃지가 반영됨(미확인)          *
* - 구독콘 바로 뒤 글자가 잘리는 문제 수정                 *
* - 기능 추가를 위한 theme 양식 변경                       *
*                                                          *
* 개발자를 위한 메세지                                     *
* - 채팅방 명령어 대응을 위해 테마 폴더명은                *
*   /[a-zA-Z0-9_-]+/ 로 지어야 함                          *
* - 긴 메세지의 하단이 여백없이 잘리는 문제의 해결을 위해  *
*   이하 사항이 변경됨                                     *
*   .chat_inner_box가 .chat_upper_box로 개명               *
*   .chat_msg_box 외부에 .chat_lower_box가 추가            *
*   이제 .chat_cheer_box 등은 .chat_lower_box 아래에 위치  *
*   기본 테마의 /* SOON DEPRECATED */ 부분 참고를 권장     *
*   0.3.x 이후 배포 테마는 호환성을 유지하지 않을 예정     *
*                                                          *
*                                                          *
* **********************************************           *
* * 0.2.4 : 9th Sep 2017                       *           *
* **********************************************           *
* 오류 수정 및 변경된 기능                                 *
* - cheer외의 아이콘을 사용한 후원 강조 메세지가 표시됨    *
*   이전 버전에선 이름에 대문자가 포함되어있을 경우 미표시 *
* - 주소에 숫자가 포함된 클립도 제대로 불러와짐            *
* - 기본 테마에서 클립 미리보기가 정상적으로 표시됨        *
* - 긴 메세지에서도 구독콘이 정상적으로 표시됨             *
*                                                          *
*                                                          *
* **********************************************           *
* * 0.2.3 : 8th Sep 2017                       *           *
* **********************************************           *
* 오류 수정 및 변경된 기능                                 *
* - 구독 메세지가 표시되지 않던 문제 수정                  *
* - 비트 후원 강조 메세지가 표시되지 않던 문제 수정        *
* - 특정 상황에서 후원 강조 메세지가 표시되던 문제 수정    *
*   cheer, 4head등의 입력이 있을 때 표시됐었음             *
* - 구독 및 후원 메세지 포맷 유연화                        *
*   구독 시작이나 금액을 표기하지 후원 메세지(트윕) 지원   *
* - 밴 유저 메세지 삭제 최적화                             *
*                                                          *
* 해결되지 않은 문제점                                     *
* - 스트리머 전용 후원 아이콘 미지원                       *
*                                                          *
* 확인되지 않은 부분                                       *
* - cheer외의 아이콘을 사용한 후원 메세지의 표기 여부      *
*                                                          *
*                                                          *
* **********************************************           *
* * 0.2.2 : 7th Sep 2017                       *           *
* **********************************************           *
* 오류 수정 및 변경된 기능                                 *
* - 디씨콘 키워드 우선순위가 정상적으로 동작               *
*   ~abcd가 ~abc보다 먼저 읽혀 더이상 뒤에 d가 남지 않음   *
* - 트윕 후원 메세지를 조금 더 잘 읽어오게 됨              *
* - 일부 유저의 이름이 표시되지 않는 문제 한번 더 수정     *
*                                                          *
*                                                          *
* **********************************************           *
* * 0.2.1 : 6th Sep 2017                       *           *
* **********************************************           *
* 추가된 기능                                              *
* - CSS 테마 웹에서 불러오기 지원                          *
*                                                          *
* 오류 수정 및 변경된 기능                                 *
* - 일부 텍스트 오류 수정                                  *
*                                                          *
*                                                          *
* **********************************************           *
* * 0.2.0 : 5th Sep 2017                       *           *
* **********************************************           *
* 추가된 기능                                              *
* - 채팅 내 구독콘 및 디씨콘 이용 가능                     *
* - 밴 유저 메세지 삭제                                    *
* - 클립 링크 미리보기                                     *
* - 구독 및 후원 메세지 강조                               *
* - 메세지 텍스트 변환                                     *
*                                                          *
* 오류 수정 및 변경된 기능                                 *
* - 일부 유저의 이름이 표시되지 않는 문제 수정             *
* - 이름 색을 바꿔본 적 없는 유저의 이름색은 랜덤으로 설정 *
*                                                          *
*                                                          *
* **********************************************           *
* * 0.1.0 : 29th Aug 2017 (Pre released)       *           *
* **********************************************           *
* 제공된 기능                                              *
* - 핵심 기능: 트위치 채팅에 접속해                        *
*              메세지를 html로 띄우기                      *
* - 유저의 로컬네임(한글닉)을 이름으로 표시                *
* - 유저 이름 색 반영 가능                                 *
* 유저 뱃지 표시 설정 가능                                 *
* CSS 테마 사용 가능                                       *
*                                                          *
*                                                          *
************************************************************


*********************** Thanks to.. ************************
*                                                          *
*      JSAssist Open DCcon                                 *
*      https://github.com/rishubil/jsassist-open-dccon     *
*                                                          *
*                                         by. rishubil     *
*                                                          *
************************************************************
